<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>TokenWeave: Efficient Compute-Communication Overlap for Distributed LLM Inference - Efficient Paper</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.css" rel="stylesheet" />
        <link href="../../../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "TokenWeave: Efficient Compute-Communication Overlap for Distributed LLM Inference";
        var mkdocs_page_input_path = "notes/2025/TokenWeave/note.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> Efficient Paper
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Paper List</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../cls_year/">By Year</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../cls_keyword/">By Keyword</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../cls_publication/">By Publication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../cls_institution/">By Institution</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../cls_author/">By Author</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Weekly Paper</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../weekly_paper/2025-07-25/">2025-07-25</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../weekly_paper/2025-08-01/">2025-08-01</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../weekly_paper/2025-08-08/">2025-08-08</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../weekly_paper/2025-08-15/">2025-08-15</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../weekly_paper/2025-08-22/">2025-08-22</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">Efficient Paper</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">TokenWeave: Efficient Compute-Communication Overlap for Distributed LLM Inference</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
  
                <h1 id="tokenweave-efficient-compute-communication-overlap-for-distributed-llm-inference">TokenWeave: Efficient Compute-Communication Overlap for Distributed LLM Inference</h1>
<blockquote>
<p>Raja Gond, Nipun Kwatra, Ramachandran Ramjee</p>
</blockquote>
<p><a class="glightbox" href="../fig8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../fig8.png" /></a></p>
<h2 id="abstract">Abstract</h2>
<p>Distributed inference of large language models (LLMs) can introduce overheads
of up to 20% even over GPUs connected via high-speed interconnects such as
NVLINK. Multiple techniques have been proposed to mitigate these overheads by
decomposing computations into finer-grained tasks and overlapping communication
with sub-tasks as they complete. However, fine-grained decomposition of a large
computation into many smaller computations on GPUs results in overheads.
Further, the communication itself uses many streaming multiprocessors (SMs),
adding to the overhead.
  We present TokenWeave to address these challenges. TokenWeave proposes a
Token-Splitting technique that divides the tokens in the inference batch into
two approximately equal subsets in a wave-aware manner. The computation of one
subset is then overlapped with the communication of the other. In addition,
TokenWeave optimizes the order of the layer normalization computation with
respect to communication operations and implements a novel fused
AllReduce-RMSNorm kernel carefully leveraging Multimem instruction support
available on NVIDIA Hopper GPUs. These optimizations allow TokenWeave to
perform communication and RMSNorm using only 2-8 SMs. Moreover, our kernel
enables the memory bound RMSNorm to be overlapped with the other batch's
computation, providing additional gains. Our evaluations demonstrate up to 29%
latency gains and up to 26% throughput gains across multiple models and
workloads. In several settings, TokenWeave results in better performance
compared to an equivalent model with all communication removed.</p>
<p>TokenWeave ä¸»è¦ç”¨åˆ°äº†ä¸‰ä¸ªæŠ€æœ¯ç‚¹ï¼š
1. Token-Splittingï¼Œå°†ä¸€ä¸ªå¤§batchçš„ä»»åŠ¡æ‹†åˆ†æˆä¸¤ä¸ªbatchï¼Œé€šè¿‡è¿™ç§å¯ä»¥å°†è®¡ç®—ä¸é€šä¿¡è¿›è¡Œoverlapï¼›ä½†ç”±äºGPUçš„wave-quantizationåŸå› ï¼ŒNaiveçš„æ‹†åˆ†æ–¹å¼å¯èƒ½å¯¼è‡´ä¸¤ä¸ªå°çš„kernelçš„å¼€é”€å¤§äºåŸæœ¬çš„ä¸€ä¸ªå¤§kernelï¼Œé€ æˆé¢å¤–çš„overheadï¼›è¿™é‡Œçš„waveæŒ‡çš„æ˜¯GPUå¹¶è¡Œè¿ç®—çš„æ³¢æŸï¼Œä¸€ä¸ªå¤§çš„kernelé€šå¸¸èƒ½è·‘æ»¡GPUçš„å¹¶è¡Œè¿ç®—èµ„æºï¼Œæ‹†åˆ†ä¸ºä¸¤ä¸ªå°kernelåï¼Œæœ‰å¯èƒ½é€ æˆå°kernelçš„æœ€åä¸€ä¸ªwaveå¹¶è¡Œæ•ˆç‡ä½ï¼›TokenWeaveæå‡ºä½¿ç”¨smartçš„æ–¹æ³•æ¥æ‹†åˆ†ï¼Œä½¿å¾—æ‹†åˆ†åçš„ä¸¤ä¸ªkernelæ¯”ä¸€ä¸ªkernelé¢å¤–å¼•å…¥çš„å¼€é”€æœ€å°ã€‚
2. RMSNormä¼˜åŒ–ï¼ŒTileLink, Fluxå’ŒNanoflowç­‰å·¥ä½œæ²¡æœ‰è€ƒè™‘å¯¹Normå‡½æ•°çš„ä¼˜åŒ–ï¼Œå®æµ‹å‘ç°RMSNormæ—¶é—´å æ¯”åœ¨8%å·¦å³ï¼›TokenWeaveæå‡ºå°†åŸæœ¬çš„AllReduce-RMSNormè¿ç®—æ”¹ä¸ºReduceScatter-RMSNorm-AllGatheræ“ä½œï¼Œä¿è¯æ•°å­¦è®¡ç®—çš„ç­‰ä»·æ€§çš„åŒæ—¶ï¼Œå‡å°‘RMSNormçš„è®¡ç®—å¼€é”€ï¼›ä½†ç®€å•çš„æ‹†åˆ†åçš„æ•ˆç‡ä¼šå˜å·®ï¼ŒTokenWeaveè®¾è®¡äº†é«˜æ•ˆçš„kernelæ¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚
3. æ–°ç‰¹æ€§çš„å¼•å…¥å‡å°‘SMçš„èµ„æºå ç”¨ï¼Œé€šè¿‡ä½¿ç”¨Multimem instructionå°†reduce offloadåˆ°NVSwitchä¸Šï¼Œä»è€Œå‡å°‘äº†SMçš„ä½¿ç”¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°†ç¬¬äºŒç‚¹RMSNormçš„kernelå®ç°ç”±éœ€è¦16-20 SMså‡å°‘åˆ°2-8 SMs
TokenWeaveåœ¨vLLM v1ç‰ˆæœ¬ä¸Šå®ç°ï¼Œå¸¦æ¥29% latencyæ”¶ç›Šï¼Œæœ€å¤š26%çš„throughputæ”¶ç›Šã€‚</p>
              
  <!-- Giscusåªåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¾ç¤ºï¼Œæœ¬åœ°å¼€å‘æ—¶éšè— -->

<div style="padding: 20px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 5px; margin: 20px 0;">
    <p><strong>ğŸ“ è¯„è®ºåŠŸèƒ½</strong></p>
    <p>è¯„è®ºåŠŸèƒ½ä»…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨ã€‚åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼ŒGiscus æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
    <p>è¯·è®¿é—®çº¿ä¸Šç‰ˆæœ¬æŸ¥çœ‹å®Œæ•´çš„è¯„è®ºåŠŸèƒ½ã€‚</p>
</div>


            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
      <script src="../../../../js/prism-prototxt.js"></script>
      <script src="../../../../js/preview.js"></script>
      <script src="../../../../js/back-to-top.js"></script>
      <script src="https://giscus.app/client.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body>
</html>
